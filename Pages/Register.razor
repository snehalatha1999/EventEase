@page "/register/{EventId:int}"
@using EventEase.Models
@inject EventEase.Services.UserSessionService Session
@inject NavigationManager Navigation

<h3>Event Registration</h3>

<EditForm Model="registrationModel" OnValidSubmit="HandleSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label>Name:</label>
        <InputText class="form-control" @bind-Value="registrationModel.Name" />
        <ValidationMessage For="@(() => registrationModel.Name)" />
    </div>

    <div class="mb-3">
        <label>Email:</label>
        <InputText class="form-control" @bind-Value="registrationModel.Email" />
        <ValidationMessage For="@(() => registrationModel.Email)" />
    </div>

    <button class="btn btn-primary" type="submit">Register</button>
</EditForm>

@if (success)
{
    <div class="alert alert-success mt-3">Successfully registered!</div>
}

@code {
    [Parameter] public int EventId { get; set; }
    private Registration registrationModel = new();
    private bool success = false;

    private void HandleSubmit()
    {
        Session.StartSession(registrationModel.Name);
        Session.RegisterForEvent(EventId);
        success = true;
    }
}
